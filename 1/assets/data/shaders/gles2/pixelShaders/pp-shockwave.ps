#include "../commons/defines.sh"
#include "../commons/uniforms.sh"
#include "../commons/varyings.sh"


void main()
{
	highp vec2 uvs = (V_Screenpos.xy *0.5) + 0.5;
	highp vec2 dir = (V_TexCoord0 - 0.5);

	highp float len = length(dir);
	dir = normalize(dir);
	
	highp float state = len - 0.35;
	
	//"opacity", this is merely 1 if we wan't to offset the pixel, 0 if we don't (with 0, the blending will ignore the color calculated here)
	lowp float opacity = ceil(clamp(0.05-abs(state),0.0,1.0));
	state *= opacity;
	
	
	highp vec2 offset = (state*dir)*0.5;
	lowp vec4 color = texture2D(BASEMAP,uvs + offset);
	color.b*=(1.0+clamp(ceil(state) ,0.0,1.0)*10.0*opacity);
	gl_FragColor = vec4(color.rgb,opacity);
}
